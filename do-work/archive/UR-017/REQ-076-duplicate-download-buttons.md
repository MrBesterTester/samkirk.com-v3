---
id: REQ-076
title: Fix duplicate Interview Summary download buttons in chat
status: completed
created_at: 2026-02-14T12:30:00Z
user_request: UR-017
claimed_at: 2026-02-14T12:35:00Z
route: B
completed_at: 2026-02-14T14:00:00Z
---

# Fix duplicate Interview Summary download buttons in chat

## What
Multiple "Interview Summary" download buttons are appearing in the chat interface as the conversation progresses. There should only be one download button.

## Context
- The Hire Me chat page renders download buttons for the Interview Summary
- As the conversation continues, duplicate download buttons accumulate instead of showing just one
- Likely a rendering issue where the download button is being added per message or per re-render rather than displayed once

---
*Source: During the chat I am getting multiple buttons for downloading "Interview Summary". There should only be one download button, not duplicates appearing as the conversation progresses.*

---

## Triage

**Route: B** - Medium

**Reasoning:** Clear bug with known symptom (duplicate download buttons in chat). Need to explore the Hire Me chat components to find where download buttons are rendered and why they duplicate.

**Planning:** Not required

## Plan

**Planning not required** - Route B: Exploration-guided implementation

Rationale: Clear bug fix — need to find the download button rendering logic in the Hire Me chat and fix the duplication.

*Skipped by work action*

## Exploration

### First attempt (failed)
- Added deduplication guard: `prev.downloads.some(d => d.submissionId === result.submissionId)` check before appending
- This did NOT work because each `sendMessage` call created a new submission on the backend (different `submissionId` each time), so the dedup check never matched

### Root cause (corrected)
- **In `web/src/hooks/useHireMe.ts`**: `sendMessage` sends `submissionId: state.fitFlow.submissionId ?? state.resumeFlow.submissionId ?? null` — for standalone interview chat (no fit/resume flow), this is always `null`
- **In `web/src/lib/interview-chat.ts:459-474`**: `getOrCreateConversation` with no `submissionId` creates a **new** conversation + submission each time, even with the same `conversationId`
- **Result**: Each API response returns a different `submissionId`, so the submissionId-based dedup never matched — a new download button was added for every message

*Generated by manual investigation*

## Implementation Summary (v2 — corrected fix)

Two changes in `web/src/hooks/useHireMe.ts`:

1. **Dedup by `type` instead of `submissionId`** (lines 815-833): Changed from `d.submissionId === result.submissionId` to `d.type === "interview"`. If an interview download already exists, updates its submissionId to the latest. Prevents duplicate buttons.

2. **Send interview submissionId back to server** (lines 785-789): Added `state.downloads.find(d => d.type === "interview")?.submissionId` to the submissionId fallback chain. This ensures subsequent messages reuse the same conversation/submission instead of creating new ones.

3. **Updated useCallback deps** (line 848): Added `state.downloads` to the dependency array.

*Completed by work action (Route B)*

## Testing

**E2E test added:** `web/e2e/interview-tool.spec.ts` — "shows only one Interview Summary button after multiple messages"
- Sends "Does Sam do his work well" → waits for response → asserts exactly 1 download button
- Sends "Does Sam know TypeScript" → waits for response → asserts STILL exactly 1 download button

**Result:** ✓ Passed (7.5s, 2 LLM round-trips)

**TypeScript compilation:** `npx tsc --noEmit` — ✓ clean (pre-existing errors in unrelated test files only)

*Verified by work action*
