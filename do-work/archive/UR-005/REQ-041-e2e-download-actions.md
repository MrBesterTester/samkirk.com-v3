---
id: REQ-041
title: E2E tests for download actions
status: completed
created_at: 2026-02-12T20:00:00Z
user_request: UR-005
related: [REQ-039, REQ-040]
batch: e2e-modality-gaps
claimed_at: 2026-02-13T12:36:00Z
route: B
completed_at: 2026-02-13T12:42:00Z
---

# E2E Tests for Download Actions

## What
Add Playwright E2E tests that click download buttons and verify the downloaded file content for all three hire-me tools. Currently: fit report has no download test at all, resume download button is only checked for visibility, and interview transcript download clicks the button but never verifies the file content.

## Detailed Requirements
- Gaps 3, 4, and 5 from docs/hire-me-tests.md "Input/Output Modality Coverage" section
- **Fit report download** (Gap 3): after completing a fit analysis, click the download button, verify a file is downloaded, and check it contains expected content (score, recommendation, categories)
- **Resume download** (Gap 4): after generating a resume, click the download button (currently only checked for visibility), verify a file is downloaded, and check it contains expected content (header, summary, skills, experience)
- **Interview transcript download** (Gap 5): after a conversation, click the download transcript button (already tested), AND verify the downloaded file content matches expectations (role labels, message content, formatting)
- Use Playwright's download handling (`page.waitForEvent('download')` or equivalent) to capture and inspect downloaded files
- Verify file format (HTML, markdown, or PDF — whichever the tools produce) and key content markers

## Context
- Existing E2E tests: web/e2e/fit-tool.spec.ts, web/e2e/resume-tool.spec.ts, web/e2e/interview-tool.spec.ts
- Unit coverage: TEST-021 (markdown renderer, 56 tests), TEST-023 (artifact bundler, 30 tests), TEST-014 (resume generation, 62 tests)
- TEST-632 already clicks the transcript download button and saves a fixture, but doesn't verify the file content/format

---
*Source: fix the Gaps as given in the section "Input/Output Modality Coverage" in docs/hire-me-tests.md — Gaps #3, #4, #5*

---

## Triage

**Route: B** - Medium

**Reasoning:** Clear feature (add download verification to E2E tests) but need to explore download button implementations, file formats produced, and existing test patterns across 3 tools.

**Planning:** Not required

## Plan

**Planning not required** - Route B: Exploration-guided implementation

Rationale: Clear testing requirement. Need to discover download format, button handlers, and Playwright download event patterns in existing tests.

*Skipped by work action*

## Exploration

- All 3 tools download ZIP files from `/api/submissions/{id}/download`
- Fit: `fit-report-{id}.zip` containing `metadata.json`, `inputs/job-text.txt`, `outputs/report.md`, `outputs/report.html`, `citations/`
- Resume: `custom-resume-{id}.zip` containing `metadata.json`, `outputs/resume.md`, `outputs/resume.html`, `citations/`
- Interview: `interview-transcript-{id}.zip` containing `metadata.json`, `outputs/transcript.md`, `outputs/transcript.html`, `outputs/conversation.json`
- Existing pattern in interview-tool.spec.ts: `page.waitForEvent("download")` + `download.saveAs()` + `download.suggestedFilename()`
- Fit/resume tests only check download button visibility, never click
- Interview test clicks and saves but never verifies ZIP contents
- Need ZIP extraction in tests to verify file structure and content

*Generated by Explore agent*

## Implementation Summary

- Created `web/e2e/helpers/zip-verify.ts` — shared helper using `adm-zip` to verify ZIP contents (file existence, non-empty entries, metadata.json validation, markdown content pattern matching)
- Modified `web/e2e/fit-tool.spec.ts` — added download + ZIP verification at end of paste-mode full-flow test (verifies fit-report ZIP filename, metadata.json, outputs/report.md with score/recommendation patterns)
- Modified `web/e2e/resume-tool.spec.ts` — added download + ZIP verification at end of paste-mode full-flow test (verifies custom-resume ZIP filename, metadata.json, outputs/resume.md with summary/experience/skill patterns)
- Modified `web/e2e/interview-tool.spec.ts` — enhanced existing TEST-632 download test with ZIP content verification (verifies interview-transcript ZIP, metadata.json, transcript content patterns)

*Completed by work action (Route B)*

## Testing

**Tests run:** `npm test` (unit) + TypeScript transpile check + Playwright test list
**Result:** All 1230 unit tests pass. All test files transpile (fit: 482 lines, resume: 322 lines, interview: 200 lines, zip-verify helper: 116 lines). 51 E2E tests listed.

**New tests added:**
- No new test blocks — download verification integrated into existing full-flow tests to avoid duplicating LLM calls

**Existing tests enhanced:**
- `web/e2e/fit-tool.spec.ts` — paste-mode full-flow test now verifies download
- `web/e2e/resume-tool.spec.ts` — paste-mode full-flow test now verifies download
- `web/e2e/interview-tool.spec.ts` — TEST-632 now verifies ZIP contents

*Verified by work action*
