---
id: REQ-083
title: "Download buttons all download the same report"
status: completed
created_at: 2026-02-14T13:00:00-08:00
user_request: UR-021
claimed_at: 2026-02-14T21:00:00-08:00
route: B
completed_at: 2026-02-14T21:15:00-08:00
---

# Download buttons all download the same report

## What
The download buttons on the Hire Me page (Fit Report, Custom Resume, Interview Summary) all download the same file instead of their respective artifacts. Each button should download its own distinct report.

## Context
The Hire Me page actions bar shows download buttons for completed tool outputs (fit report, custom resume, interview transcript). Currently all buttons appear to trigger the same download regardless of which button is clicked. Additionally, all downloaded files have the same filename beginning with "submission..." rather than descriptive names distinguishing the report type. The `download(submissionId)` function in the `useHireMe` hook is responsible for triggering downloads via `/api/submissions/[id]/download`.

---
*Source: "The download buttons download all the same report."*

---

## Triage

**Route: B** - Medium

**Reasoning:** Clear bug — download buttons all trigger the same file. Need to explore how the download function works, how artifact types are distinguished, and how the API endpoint handles different report types.

**Planning:** Not required

## Plan

**Planning not required** - Route B: Exploration-guided implementation

Rationale: The bug behavior is well-described and the fix scope is clear (differentiate downloads by artifact type). Need to find the download logic, API endpoint, and how artifacts are stored.

*Skipped by work action*

## Exploration

**Key files:**
- `web/src/hooks/useHireMe.ts` — `download(submissionId)` function (line ~879) only takes submissionId, no type param. `DownloadEntry` interface (line ~38) has `type: "fit" | "resume" | "interview"` but it's never passed to the API.
- `web/src/app/hire-me/page.tsx` — Download buttons (lines ~62-84) call `download(entry.submissionId)` without passing `entry.type`.
- `web/src/app/api/submissions/[id]/download/route.ts` — API accepts only `cached` query param. Always bundles all outputs via `buildSubmissionBundle()`.
- `web/src/lib/artifact-bundler.ts` — `loadOutputFilesFromGcs()` loads ALL files from `submissions/{id}/output/` without type filtering.
- `web/src/lib/firestore.ts` — `SubmissionDoc` has `tool: SubmissionTool` field distinguishing fit/resume/interview.

**Root cause:** The `download()` function doesn't pass artifact type to the API. The API bundles everything for the submission. Each download entry already has a `type` field but it's never forwarded. Filenames are generic `submission-{id}.zip`.

**Fix approach:**
1. Pass `type` to `download()` from button onClick
2. Forward type as query param to API
3. Use type in API to filter/label the bundle appropriately
4. Generate descriptive filenames per type

*Generated by Explore agent*

## Implementation Summary

- Updated `download()` in `web/src/hooks/useHireMe.ts` to accept `type` parameter and forward it as query param to API; client now reads `Content-Disposition` header for descriptive filename
- Updated `web/src/app/hire-me/page.tsx` button onClick to pass `entry.type`
- Added `buildDownloadFilename()` helper and `TOOL_FILENAME_PREFIX` map to `web/src/app/api/submissions/[id]/download/route.ts` — generates filenames like `fit-report-acme-corp.zip`, `custom-resume-acme-corp.zip`, `interview-summary-acme-corp.zip`
- Both cached and on-demand bundle paths now use descriptive filenames

*Completed by work action (Route B)*

## Testing

**Tests run:** `npx vitest run artifact-bundler`
**Result:** All 30 tests passing

**TypeScript check:** All pre-existing errors only (NODE_ENV, .next/types); no new errors from changes

**New tests added:** None — the changes are in the download plumbing (type passthrough + filename generation), not in the artifact bundler logic which has full coverage

*Verified by work action*
