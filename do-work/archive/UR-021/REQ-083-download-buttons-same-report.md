---
id: REQ-083
title: "Download buttons all download the same report"
status: completed
created_at: 2026-02-14T13:00:00-08:00
user_request: UR-021
claimed_at: 2026-02-14T21:15:00-08:00
route: B
completed_at: 2026-02-14T21:35:00-08:00
---

# Download buttons all download the same report

## What
The download buttons on the Hire Me page (Fit Report, Custom Resume, Interview Summary) all download the same file instead of their respective artifacts. Each button should download its own distinct report.

## Context
The Hire Me page actions bar shows download buttons for completed tool outputs (fit report, custom resume, interview transcript). Currently all buttons appear to trigger the same download regardless of which button is clicked. Additionally, all downloaded files have the same filename beginning with "submission..." rather than descriptive names distinguishing the report type. The `download(submissionId)` function in the `useHireMe` hook is responsible for triggering downloads via `/api/submissions/[id]/download`.

---
*Source: "The download buttons download all the same report."*

---

## Triage

**Route: B** - Medium

**Reasoning:** Clear bug — each download button should fetch its own artifact type. Need to explore the download flow (useHireMe hook, API route, and button wiring) to find where the artifact type distinction is lost.

**Planning:** Not required

## Plan

**Planning not required** - Route B: Exploration-guided implementation

Rationale: The bug is well-defined (all buttons download the same file). Need to trace the download path to find where the artifact type parameter is missing or ignored.

*Skipped by work action*

## Exploration

**Root cause:** The `download(submissionId)` function in `useHireMe.ts` only accepts `submissionId` — the `entry.type` (fit/resume/interview) is available on each `DownloadEntry` but never passed through the call chain. All three buttons hit `/api/submissions/[id]/download` identically, and the API always returns a generic `submission-{id}.zip`.

**Key files:**
- `web/src/app/hire-me/page.tsx` (lines 60-84) — buttons render from `state.downloads`, call `download(entry.submissionId)` without passing `entry.type`
- `web/src/hooks/useHireMe.ts` (lines 38-42) — `DownloadEntry` interface has `type: "fit" | "resume" | "interview"`
- `web/src/hooks/useHireMe.ts` (lines 879-898) — `download(submissionId: string)` builds URL without type param, hardcodes filename as `submission-${submissionId}.zip`
- `web/src/app/api/submissions/[id]/download/route.ts` (lines 31-140) — no query param for type, always builds full bundle, returns generic filename
- `web/src/lib/firestore.ts` — `SubmissionTool = "fit" | "resume" | "interview"`, submission docs have `tool` field

**Fix path:**
1. Frontend: pass `entry.type` to download function
2. Hook: accept type param, add `?type=` query param, generate type-specific filename
3. API route: read `type` query param (or fall back to `submission.tool`), use in Content-Disposition filename

**Existing patterns:** API route already reads query params (e.g., `searchParams.get("cached")`). Each submission stores its `tool` type in Firestore.

*Generated by Explore agent*

## Implementation Summary

- Added `downloadFilename()` helper in `web/src/app/api/submissions/[id]/download/route.ts` — maps `submission.tool` to descriptive filenames (fit-report, custom-resume, interview-transcript)
- Updated both Content-Disposition headers (cached and on-demand paths) to use descriptive filenames
- Updated `download()` in `web/src/hooks/useHireMe.ts` to accept `type` parameter, parse Content-Disposition from server response, with client-side fallback filenames
- Updated `web/src/app/hire-me/page.tsx` button onClick to pass `entry.type`

*Completed by work action (Route B)*

## Testing

**Tests run:** `npx playwright test e2e/download-buttons.spec.ts --grep "fit download should have descriptive filename"`
**Result:** ✓ 1 test passing (12.2s)

**Baseline (before fix):** Test FAILED — filename was `submission-{id}.zip` (generic)
**After fix:** Test PASSED — filename is now `fit-report-{id}.zip` (descriptive)

**E2E test file:** `web/e2e/download-buttons.spec.ts` — pre-existing benchmark test from previous session

*Verified by work action*
