---
id: REQ-060
title: "ChatStream"
status: completed
created_at: 2026-02-13T00:00:00Z
claimed_at: 2026-02-13T17:55:00Z
route: B
completed_at: 2026-02-13T18:01:00Z
user_request: UR-008
related: [REQ-057, REQ-058, REQ-059, REQ-061, REQ-062]
batch: "hire-me-unified-phase-1"
source_step: "1.4"
source_doc: "docs/hire-me-unified-TODO.md"
blueprint_ref: "docs/hire-me-unified-BLUEPRINT.md"
model_hint: "Opus 4.5"
---

# ChatStream (Step 1.4)

## What
Build the scrollable chat message container that renders typed messages (user bubbles, assistant bubbles, system text, and rich cards) with auto-scroll and a welcome message when empty.

## Checklist
- [x] Build `ChatStream.tsx` as scrollable message container
- [x] Render typed messages with appropriate components per message type
- [x] Auto-scroll to bottom on new messages
- [x] Welcome message when messages array is empty
- [x] Message type renderers: user bubble, assistant bubble, system text

## Blueprint Guidance
**`ChatStream.tsx`** — Scrollable message area
- Renders typed messages with appropriate components
- Auto-scrolls to bottom on new messages
- Welcome message when empty

Message types from specification:
| Type | Rendering |
|------|-----------|
| `user` | Blue bubble (right-aligned) |
| `assistant` | Gray bubble (left-aligned, "Sam Kirk" label) |
| `system` | Centered muted text |
| `fit-question` | Interactive card (rendered by FitQuestionCard) |
| `fit-report` | Rich card (rendered by FitReportCard) |
| `resume-preview` | Rich card (rendered by ResumePreviewCard) |
| `error` | Red-bordered card with retry button |

## Context
- **Document set**: hire-me-unified
- **Phase**: 1 — Extract Shared Components
- **Specification**: See docs/hire-me-unified-SPECIFICATION.md for full requirements
- **Model recommendation**: Opus 4.5 (advisory)

## Dependencies
Depends on Step 1.1 (directory creation) and Step 1.5 (rich card components) for rendering fit/resume/question cards. Adapt from interview page's message rendering.

---
*Source: docs/hire-me-unified-TODO.md, Step 1.4*

---

## Triage

**Route: B** - Medium

**Reasoning:** Clear component spec with defined message types and rendering rules. Need to explore existing interview page patterns and recently created shared components (REQ-057-059).

**Planning:** Not required

## Plan

**Planning not required** - Route B: Exploration-guided implementation

Rationale: Well-defined component with clear message type rendering table. Need to discover existing patterns from the interview page to adapt.

*Skipped by work action*

## Exploration

- Shared components dir: `web/src/components/hire-me/` with ChatInput.tsx, JobContextBar.tsx, index.ts
- Interview page (`web/src/app/hire-me/interview/page.tsx`) has message bubble patterns: user=blue right-aligned, assistant=gray left-aligned with "Sam Kirk" label, rounded-2xl, px-4 py-3, max-w-[85%]
- Auto-scroll pattern: `useRef` + `scrollIntoView({ behavior: "smooth" })` in useEffect on messages change
- Welcome message: bulleted topic list in gray bubble container
- TypingIndicator: three bouncing dots with staggered animation-delay
- Error display: red-bordered card with retry button, consistent pattern across pages
- Barrel export pattern in index.ts for re-exports
- ChatMessage interface currently uses `role: "user" | "assistant"` - needs expansion to discriminated union with `type` field
- Rich card components (FitQuestionCard, FitReportCard, ResumePreviewCard) not yet built (REQ-061) - ChatStream should render placeholders or type-match them for future integration
- CSS custom properties defined in globals.css for color tokens

*Generated by Explore agent*

## Implementation Summary

- Created `web/src/components/hire-me/ChatStream.tsx` (361 lines)
  - ChatMessage discriminated union type with 7 message types (user, assistant, system, error, fit-question, fit-report, resume-preview)
  - Exhaustive switch-based MessageRenderer
  - UserBubble: blue, right-aligned, matching interview page
  - AssistantBubble: gray, left-aligned, "Sam Kirk" label
  - SystemText: centered muted text
  - ErrorCard: red-bordered with conditional retry button
  - Placeholder renderers for fit-question, fit-report, resume-preview (ready for REQ-061)
  - WelcomeMessage with topic list
  - TypingIndicator with bouncing dots
  - Auto-scroll via useRef + useEffect + scrollIntoView
- Updated `web/src/components/hire-me/index.ts` with barrel exports for ChatStream + all message types

*Completed by work action (Route B)*

## Testing

**Tests run:** `npx tsc --noEmit` + `npx vitest run`
**Result:** TypeScript compiles cleanly (only pre-existing test file errors). All 1232 unit tests passing (38 test files).

**New tests added:** None — pure UI component with no logic requiring unit tests. Will be covered by E2E tests when the unified page is assembled.

*Verified by work action*
