---
id: REQ-085
title: PDF format support for all downloads and uploads
status: completed
created_at: 2026-02-14T20:00:00Z
user_request: UR-023
claimed_at: 2026-02-14T22:30:00Z
route: C
completed_at: 2026-02-14T23:15:00Z
---

# PDF Format Support for All Downloads and Uploads

## What
Add PDF as a format option for all downloadable outputs (fit reports, custom resumes, chat transcripts) and support PDF file uploads where applicable.

## Why
A lot of users will want PDF format — it's the standard for professional documents, especially resumes and reports shared with hiring teams.

## Context
- User explicitly flagged code complexity and compute time as concerns — the chosen library should be lightweight and fast
- Must carefully research TypeScript PDF libraries before implementation (e.g., pdf-lib, jsPDF, Puppeteer/Chromium-based rendering, react-pdf)
- Consider server-side vs client-side generation tradeoffs
- Current downloads are likely markdown/text — PDF adds formatting, layout, and potentially styling

## Builder Guidance
- Certainty level: Firm on the feature, exploratory on implementation
- Scope cues: User is aware this could get complex — choose the simplest viable approach
- Research the PDF library landscape for TypeScript thoroughly before committing to one

---
*Source: Allow for the PDF format on all downloads and file uploads. Consider the amount of complexity in the code and resulting compute time required. A lot of people will want this. Better research the PDF libraries for TypeScript carefully.*

---

## Triage

**Route: C** - Complex

**Reasoning:** New feature spanning multiple download/upload flows, requires PDF library research and architectural decisions (server-side vs client-side generation). Touches fit reports, custom resumes, and chat transcripts.

**Planning:** Required

## Plan

### Library Decision: `@react-pdf/renderer`

| Library | Bundle | Server/Client | HTML Rendering | Verdict |
|---|---|---|---|---|
| jsPDF | ~280KB | Both | No | Manual layout — poor fit |
| pdf-lib | ~400KB | Both | No | Editing/forms only — poor fit |
| @react-pdf/renderer | ~1.5MB | Server (Node) | JSX-to-PDF, Yoga layout | **Best fit** |
| Puppeteer | ~300MB+ | Server | Full CSS | Way too heavy |
| pdfmake | ~1.2MB | Both | JSON doc definition | Decent alternative |

**Choice: `@react-pdf/renderer`** — generates PDFs from JSX in Node.js (no Chromium), fast (<500ms for 2-page docs), native TypeScript, structured data types (`FitAnalysis`, `ResumeContent`) map naturally to JSX templates.

### Scope Findings

**Downloads needing PDF generation:**
1. Fit Report — `storeFitReportArtifacts()` in `fit-report.ts` writes `report.md` + `report.html`
2. Custom Resume — `storeResumeArtifacts()` in `resume-generator.ts` writes `resume.md` + `resume.html`
3. Interview Transcript — stored via `interview-chat.ts` as `transcript.md` + `transcript.html`

**Uploads already handle PDF:** `job-ingestion.ts` uses `pdf-parse` for PDF upload. No upload work needed.

**Artifact bundler:** `loadOutputFilesFromGcs()` in `artifact-bundler.ts` loads all files from GCS `output/` prefix — PDF files will be included in ZIP automatically.

### Implementation Steps

1. Install `@react-pdf/renderer`, verify Node.js/Next.js compatibility
2. Create `web/src/lib/pdf-renderer.ts` — shared styles + document templates for fit report, resume, transcript
3. Unit tests for `pdf-renderer.ts` (valid PDF buffer, edge cases)
4. Integrate into `fit-report.ts` — add `report.pdf` alongside `.md`/`.html`
5. Integrate into `resume-generator.ts` — add `resume.pdf`
6. Integrate into `interview-chat.ts` — add `transcript.pdf`
7. Verify artifact bundler includes PDFs (no spurious HTML generation for `.pdf`)
8. E2E testing

### Risks
- `@react-pdf/renderer` ESM/CJS interop with turbopack (may need dynamic import)
- Font loading for professional resume output
- Large transcript PDFs (benchmark with 20+ turns)

*Generated by Plan agent*

## Exploration

### Integration Points

| Component | File | Function | Data | GCS Path |
|---|---|---|---|---|
| Fit Report | `fit-report.ts` | `storeFitReportArtifacts()` | `FitAnalysis`, `ExtractedJobFields`, `Citation[]` | `output/report.pdf` |
| Resume | `resume-generator.ts` | `storeResumeArtifacts()` | `ResumeContent` (structured header/summary/skills/experience/education) | `output/resume.pdf` |
| Transcript | `interview-chat.ts` | `saveTranscript()` | `InterviewConversation` with `ChatMessage[]` | `output/transcript.pdf` |
| Bundler | `artifact-bundler.ts` | `loadOutputFilesFromGcs()` | All output files (no extension filtering) | Auto-includes PDFs |
| Storage | `storage.ts` | `writeBuffer(bucket, path, buffer, contentType)` | Existing helper for binary writes | N/A |

### Key Patterns
- All artifact storage uses `getPrivateBucket()` + `PrivatePaths.submissionOutput(id, filename)` + `writeFile()`/`writeBuffer()`
- Bundler has zero file extension filtering — PDFs auto-included
- CSS palette: `#333` body, `#0366d6` links, `#f6f8fa` code bg, system fonts, 1.6 line-height
- Existing deps: `pdf-parse` (upload only), no PDF generation library yet

*Generated by Explore agent*

## Implementation Summary

### New File
- `web/src/lib/pdf-renderer.tsx` — Core PDF rendering module using `@react-pdf/renderer`
  - Shared color palette mirroring `DEFAULT_MARKDOWN_CSS`
  - `FitReportPdf` template: score banner, recommendation, category breakdown, unknowns, extracted job details, citations
  - `ResumePdf` template: professional layout with centered header, contact row, skills grid, experience with bullets, education
  - `TranscriptPdf` template: interview metadata, timestamped messages, citations
  - Exports: `renderFitReportPdf()`, `renderResumePdf()`, `renderTranscriptPdf()` — each returns `Promise<Buffer>`

### Modified Files
- `web/src/lib/fit-report.ts` — Added dynamic import of `renderFitReportPdf`, writes `report.pdf` to GCS
- `web/src/lib/resume-generator.ts` — Added dynamic import of `renderResumePdf`, writes `resume.pdf` to GCS
- `web/src/lib/interview-chat.ts` — Added dynamic import of `renderTranscriptPdf`, writes `transcript.pdf` to GCS
- `web/src/lib/fit-report.test.ts` — Added `writeBuffer` mock and `pdf-renderer` mock
- `web/src/lib/resume-generator.test.ts` — Added `writeBuffer` mock and `pdf-renderer` mock
- `web/src/lib/interview-chat.test.ts` — Added `writeBuffer` mock and `pdf-renderer` mock

### Dependency Added
- `@react-pdf/renderer` in `web/package.json`

### Design Decisions
- Dynamic imports avoid ESM/CJS interop issues with turbopack
- `.tsx` extension for JSX template syntax
- No changes to `artifact-bundler.ts` — PDFs auto-included from GCS output/ prefix
- Server-only via `"server-only"` import

*Completed by work action (Route C)*

## Testing

**Tests run:** `npm test -- --run`
**Result:** ✓ 1253 tests passing (37/38 test files pass)

**Pre-existing failure:** `page.test.tsx` — CTA link text mismatch (unrelated to PDF)

**Existing tests updated:**
- `fit-report.test.ts` — added `writeBuffer` mock + `pdf-renderer` mock (164 tests passing)
- `resume-generator.test.ts` — added `writeBuffer` mock + `pdf-renderer` mock (all tests passing)
- `interview-chat.test.ts` — added `writeBuffer` mock + `pdf-renderer` mock (all tests passing)

*Verified by work action*
