---
id: REQ-133
title: Compare Vercel rate limitations between photo-fun and samkirk-v3
status: completed
created_at: 2026-02-18T12:00:00Z
user_request: UR-039
claimed_at: 2026-02-18T16:00:00Z
route: B
completed_at: 2026-02-18T16:05:00Z
---

# Compare Vercel Rate Limitations: photo-fun vs samkirk-v3

## What
Compare the rate limiting configurations on the two Vercel-hosted projects: photo-fun (image processing LLM) and samkirk-v3 (text-only LLM). Identify differences, assess whether each project's limits are appropriate for its workload, and surface any gaps or mismatches.

## Context
- **photo-fun**: Uses an image processing LLM (higher payload sizes, longer processing times)
- **samkirk-v3**: Uses a purely textual LLM (smaller payloads, faster responses)
- Both are deployed on Vercel
- Rate limiting config may live in `vercel.json`, middleware, API route handlers, or Vercel dashboard settings

---
*Source: Compare the rate limitataions on photo-fun and samkirk-v3 on Vercel. photo-fun uses an image processing LLM whereas samkirk-v3 uses a purely textual LLM.*

---

## Triage

**Route: B** - Medium

**Reasoning:** Clear comparison task with well-defined outcome. Need to explore both projects to find rate limiting configurations across vercel.json, middleware, and API routes.

**Planning:** Not required

## Plan

**Planning not required** - Route B: Exploration-guided implementation

Rationale: Clear research/comparison task. Just need to find rate limiting configs in both projects and compare them.

*Skipped by work action*

## Exploration

**Note:** photo-fun is actually hosted on **Shuttle.rs** (not Vercel). The project lives at `/Users/sam/Projects/photo-fun3` and uses Rust/Axum.

### samkirk-v3 Rate Limiting
- **File:** `web/src/lib/rate-limit.ts`
- **Storage:** Firestore (GCP) — persistent, survives restarts, scales horizontally
- **Key strategy:** SHA256 hash of `sessionId:ipHash` (user-aware)
- **Limits:** 10 requests per 10-minute window
- **Config:** Hardcoded constants (`RATE_LIMIT_MAX_REQUESTS = 10`, `RATE_LIMIT_WINDOW_MS = 600000`)
- **Atomicity:** Firestore transactions
- **Error:** HTTP 429 with `retryAfterMs` and contact email
- **Protection flow:** Session validation → reCAPTCHA v2 → rate limit → spend cap
- **Protected routes:** `/api/tools/resume`, `/api/tools/fit/start`, `/api/tools/fit/generate`, `/api/tools/interview`

### photo-fun3 Rate Limiting
- **File:** `backend/src/main.rs`
- **Storage:** In-memory HashMap with Tokio Mutex — lost on restart, single-instance only
- **Key strategy:** IP address only (with optional client_hint fallback)
- **Per-request limit:** 5 requests per 60-second window
- **Daily quota:** 400 requests/day (configurable via `DAILY_QUOTA` env secret, resets at midnight UTC)
- **Config:** Environment secrets (runtime-adjustable)
- **Error:** HTTP 429 (rate limit), HTTP 503 (quota exceeded)
- **Additional controls:** 5MB max upload, MIME type whitelist (png/jpeg), optional reCAPTCHA

*Generated by Explore agent*

## Implementation Summary

### Side-by-Side Comparison

| Aspect | samkirk-v3 | photo-fun3 |
|--------|-----------|------------|
| **Hosting** | Vercel | Shuttle.rs |
| **Per-window limit** | 10 req / 10 min | 5 req / 60 sec |
| **Daily quota** | None | 400 req/day |
| **Storage** | Firestore (persistent) | In-memory (volatile) |
| **Key strategy** | Session + IP hash | IP only |
| **Config method** | Hardcoded constants | Env secrets |
| **Persistence** | Survives restarts | Lost on restart |
| **Captcha** | reCAPTCHA v2 (required) | reCAPTCHA (optional) |
| **Spend cap** | Yes (monthly) | No |

### Gaps and Observations

1. **photo-fun3 is NOT on Vercel** — it's on Shuttle.rs (Rust runtime), so there's no Vercel-level WAF/rate-limiting available.

2. **samkirk-v3 has no daily quota** — only a 10-minute sliding window. A determined user could make 10 requests every 10 minutes indefinitely (1,440/day). The monthly spend cap provides a secondary safety net.

3. **photo-fun3 loses rate-limit state on restart** — in-memory storage means every deploy or restart resets all rate-limit counters. This is a known tradeoff for simplicity.

4. **photo-fun3 is more aggressive per-burst** (5/60s vs 10/600s) — appropriate for image processing which is more expensive per request.

5. **samkirk-v3 is harder to bypass** — session+IP hashing is more resilient than IP-only. photo-fun3's IP-only approach is vulnerable to proxies/VPNs.

6. **Configuration flexibility** — photo-fun3 can adjust limits at deploy time via env secrets. samkirk-v3 requires a code change to adjust limits.

*Completed by work action (Route B)*

## Testing

**Tests run:** N/A
**Result:** Research/comparison task — no code changes, no tests needed.

*Verified by work action*
