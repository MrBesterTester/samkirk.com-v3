---
id: REQ-133
title: Compare Vercel rate limitations between photo-fun and samkirk-v3
status: completed
created_at: 2026-02-18T12:00:00Z
user_request: UR-039
claimed_at: 2026-02-18T16:00:00Z
route: B
completed_at: 2026-02-18T16:05:00Z
---

# Compare Vercel Rate Limitations: photo-fun vs samkirk-v3

## What
Compare the rate limiting configurations on the two Vercel-hosted projects: photo-fun (image processing LLM) and samkirk-v3 (text-only LLM). Identify differences, assess whether each project's limits are appropriate for its workload, and surface any gaps or mismatches.

## Context
- **photo-fun**: Uses an image processing LLM (higher payload sizes, longer processing times)
- **samkirk-v3**: Uses a purely textual LLM (smaller payloads, faster responses)
- Both are deployed on Vercel
- Rate limiting config may live in `vercel.json`, middleware, API route handlers, or Vercel dashboard settings

---
*Source: Compare the rate limitataions on photo-fun and samkirk-v3 on Vercel. photo-fun uses an image processing LLM whereas samkirk-v3 uses a purely textual LLM.*

---

## Triage

**Route: B** - Medium

**Reasoning:** Clear comparison task with well-defined outcome. Need to explore both projects to find rate limiting configurations across vercel.json, middleware, and API routes.

**Planning:** Not required

## Plan

**Planning not required** - Route B: Exploration-guided implementation

Rationale: Clear research/comparison task. Just need to find rate limiting configs in both projects and compare them.

*Skipped by work action*

## Exploration

**Correction:** The correct project is **photo-fun5** at `/Users/sam/Projects/photo-fun5` (Vite + React, hosted on Vercel). Shuttle.rs shut down; photo-fun3 is the old Rust version.

### samkirk-v3 Rate Limiting
- **File:** `web/src/lib/rate-limit.ts`
- **Storage:** Firestore (GCP) — persistent, survives restarts, scales horizontally
- **Key strategy:** SHA256 hash of `sessionId:ipHash` (user-aware)
- **Limits:** 10 requests per 10-minute window
- **Config:** Hardcoded constants (`RATE_LIMIT_MAX_REQUESTS = 10`, `RATE_LIMIT_WINDOW_MS = 600000`)
- **Atomicity:** Firestore transactions
- **Error:** HTTP 429 with `retryAfterMs` and contact email
- **Protection flow:** Session validation → reCAPTCHA v2 → rate limit → spend cap
- **Protected routes:** `/api/tools/resume`, `/api/tools/fit/start`, `/api/tools/fit/generate`, `/api/tools/interview`

### photo-fun5 Rate Limiting
- **Client-side session cap:** 10 requests per browser session (`MAX_SESSION_REQUESTS` in `App.tsx`)
- **No server-side rate limiter** — no middleware, no `@upstash/ratelimit`, no in-memory limiter
- **Gemini API tier limits:** RPM/TPM/RPD enforced by Google (Tier 1, ~20 RPD for `gemini-3-pro-image-preview`)
- **Output token cap:** 8,192 tokens per request (~$0.13/request cost bound)
- **Vercel WAF:** Documented as recommended (20-30 req/60s per IP) but **not yet enabled**
- **GCP budget:** $20/month alert thresholds (notifications only, not a hard cap)
- **Error:** HTTP 429 with JSON `{ "error": "Rate limit exceeded..." }` when Gemini returns 429
- **No vercel.json** — no function timeout overrides or WAF config in code

*Generated by Explore agent (corrected — photo-fun5, not photo-fun3)*

## Implementation Summary

### Side-by-Side Comparison

| Aspect | samkirk-v3 | photo-fun5 |
|--------|-----------|------------|
| **Hosting** | Vercel | Vercel |
| **Framework** | Next.js | Vite + React SPA |
| **Server-side rate limit** | 10 req / 10 min (Firestore) | None (relies on Gemini API tiers) |
| **Client-side cap** | None | 10 req / session |
| **Daily quota** | None (spend cap instead) | ~20 RPD (Gemini Tier 1) |
| **Storage** | Firestore (persistent) | N/A (no custom rate limiter) |
| **Key strategy** | Session + IP hash | N/A |
| **Captcha** | reCAPTCHA v2 (required) | None |
| **Vercel WAF** | Not configured | Documented but not enabled |
| **Spend cap** | Monthly (Firestore-tracked) | GCP budget alerts ($20/mo) |
| **Per-request cost bound** | Token limits on LLM calls | 8,192 output tokens (~$0.13) |

### Gaps and Observations

1. **photo-fun5 has no server-side rate limiting** — it relies entirely on the client-side session cap (easily bypassed via devtools or direct API calls) and Gemini's own API tier limits. samkirk-v3 has robust Firestore-backed enforcement.

2. **Vercel WAF is documented but not enabled on photo-fun5** — the `docs/cost-security_gcp-vercel.md` describes a 20-30 req/60s per-IP rule but it hasn't been turned on in the Vercel dashboard. This is the most impactful gap.

3. **No reCAPTCHA on photo-fun5** — samkirk-v3 requires reCAPTCHA v2 before any tool use. photo-fun5 has no captcha, making it easier for bots to hit the API directly.

4. **samkirk-v3 has no daily quota** — only a 10-minute sliding window. A determined user could make 10 requests every 10 minutes indefinitely (1,440/day). The monthly spend cap provides a secondary safety net.

5. **Both projects lack hard spend caps** — samkirk-v3 uses a Firestore-tracked monthly cap, but photo-fun5's GCP budget is notification-only. Neither project will automatically stop spending if limits are exceeded.

6. **photo-fun5's client-side cap is trivially bypassable** — `MAX_SESSION_REQUESTS = 10` is enforced in React state. Anyone calling `/api/image-edit` directly bypasses it entirely.

*Completed by work action (Route B) — corrected 2026-02-18*

## Testing

**Tests run:** N/A
**Result:** Research/comparison task — no code changes, no tests needed.

*Verified by work action*
