---
id: REQ-073
title: Chat text box doesn't scroll during conversation
status: completed
created_at: 2026-02-14T10:52:00Z
user_request: UR-014
claimed_at: 2026-02-14T11:10:00Z
route: B
completed_at: 2026-02-14T11:14:00Z
---

# Chat text box doesn't scroll during conversation

## What
The chat message area on the Hire Me page doesn't auto-scroll to show new messages during a conversation. When new messages are added, the user has to manually scroll down to see them.

## Context
- ChatStream component: `web/src/components/hire-me/ChatStream.tsx`
- ChatStream has fixed height `h-[28rem] sm:h-[32rem]` with `overflow-y-auto`
- There is existing auto-scroll logic using `useRef` with smooth scroll to bottom on new messages — it may be broken or not triggering correctly
- Could also be that the scroll container ref isn't attached to the right element, or the scroll fires before the DOM updates

---
*Source: the text box during the chat doesn't scroll.*

---

## Triage

**Route: B** - Medium

**Reasoning:** Clear bug (auto-scroll broken), but need to explore the existing scroll logic in ChatStream to understand why it's not working.

**Planning:** Not required

## Plan

**Planning not required** - Route B: Exploration-guided implementation

Rationale: Auto-scroll bug with known component. Need to see the existing scroll logic to understand the root cause.

*Skipped by work action*

## Exploration

- ChatStream.tsx:332 — scroll container is `div.flex-1.overflow-y-auto.p-4`
- ChatStream.tsx:377 — `messagesEndRef` attached to empty div anchor at bottom
- ChatStream.tsx:325-329 — `useEffect` calls `scrollIntoView()` on anchor, deps: `[messages, isLoading]`
- page.tsx:112 — parent wrapper `div.h-[32rem] sm:h-[36rem]` is NOT a flex container, so `flex-1` won't fill
- Root causes: (1) parent missing `flex flex-col` so scroll container doesn't get proper height, (2) `scrollIntoView()` on empty anchor unreliable — should use `scrollTop = scrollHeight` on the container directly
- Messages added via `useHireMe.ts:addMessage` → state update → re-render → useEffect should fire

*Generated by Explore agent*

## Implementation Summary

- **page.tsx:112** — Added `flex flex-col` to ChatStream parent wrapper so `flex-1` fills the fixed height properly
- **ChatStream.tsx** — Replaced `messagesEndRef` + `scrollIntoView()` with `scrollContainerRef` on the scroll container + `el.scrollTo({ top: el.scrollHeight, behavior: "smooth" })` wrapped in `requestAnimationFrame`
- Removed unused empty anchor div at bottom of message list

*Completed by work action (Route B)*

## Testing

**Tests run:** `npx vitest run` (full suite)
**Result:** 1255/1255 passing (38 test files)

**No dedicated ChatStream tests exist** — the fix is a DOM/layout change verified visually.

*Verified by work action*
