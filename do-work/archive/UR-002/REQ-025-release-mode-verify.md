---
id: REQ-025
title: "Release mode verification"
status: completed
created_at: 2026-02-06T12:00:00-08:00
user_request: UR-002
claimed_at: 2026-02-06T20:30:00-08:00
route: B
completed_at: 2026-02-06T20:40:00-08:00
source_step: "4.2"
source_doc: "docs/master-test-TODO.md"
blueprint_ref: "docs/master-test-BLUEPRINT.md"
model_hint: "Gemini 3 Pro"
batch: "master-test-phase-4"
related: [REQ-024]
---

# Release mode verification (Step 4.2)

## What
Verify the `--release` mode of the master test runner: all suites must run (no skips allowed), `release_candidate: true` in frontmatter, manual verification checklist printed, and proper exit code behavior.

## Checklist
- [x] Run `npm run test:all -- --release` with GCP credentials
- [x] Verify all suites run (no skips allowed)
- [x] Verify `release_candidate: true` in summary.md frontmatter
- [x] Verify manual verification checklist printed
- [x] Verify exit code 1 when suites are skipped (without GCP)

## Blueprint Guidance
- **Goal**: Verify `--release` mode behavior
- **Implementation**:
  1. Run `npm run test:all -- --release` with GCP credentials available
  2. Confirm all suites run (no skips)
  3. Confirm `release_candidate: true` in summary.md frontmatter
  4. Confirm manual verification checklist is printed
  5. Confirm exit code is 1 if any suite was skipped
- **Test plan**: Run with and without GCP credentials, verify different behaviors

## Context
- **Document set**: master-test
- **Phase**: 4 — Verification and Integration
- **Specification**: See docs/master-test-SPECIFICATION.md for full requirements (Section 5.5 Release Gate)
- **Model recommendation**: Gemini 3 Pro (advisory — use if your tool supports model selection)

## Dependencies
Depends on Phases 1-3 being complete. Step 4.1 should run first as a sanity check.

---
*Source: docs/master-test-TODO.md, Step 4.2*

---

## Triage

**Route: B** - Medium

**Reasoning:** Verification task with clear outcome but need to explore the test runner implementation to understand --release flag behavior, summary output location, and exit code handling.

**Planning:** Not required

## Plan

**Planning not required** - Route B: Exploration-guided implementation

Rationale: Clear verification checklist — just need to find how the test runner implements --release mode to verify behavior.

*Skipped by work action*

## Exploration

- Test runner at `web/scripts/test-all.ts` (~1019 lines)
- `--release` flag: forces `args.gcp = true` (line 928), requires GCP credentials, runs all 4 suites
- `release_candidate: true` added to summary frontmatter at lines 824-826
- Release verification checklist printed by `printReleaseChecklist()` (lines 659-696)
- GCP detection via `detectGcp()` reads `GCP_PROJECT_ID` and `GCS_PUBLIC_BUCKET` from env
- Exit code 1 when GCP missing in release mode (lines 923-926)
- Summary archives to `do-work/archive/test-runs/{TIMESTAMP}/summary.md`

*Generated by Explore agent*

## Implementation Summary

Verification task — no code changes made. Ran `--release` mode and verified all behaviors:

1. **All suites run (no skips)**: Confirmed — suites_run: [unit, e2e, e2e-real, smoke]
2. **`release_candidate: true` in frontmatter**: Confirmed in `do-work/archive/test-runs/2026-02-06_14-18-50/summary.md`
3. **Release verification checklist printed**: Confirmed — 7-item checklist with pass/fail indicators
4. **Exit code 1 without GCP**: Confirmed — `GCP_PROJECT_ID= GCS_PUBLIC_BUCKET= npx tsx scripts/test-all.ts --release --no-archive` exits with code 1 and error message

**Notes**: Some pre-existing test failures (1 unit, 23 E2E) and expired GCP auth tokens caused test failures — these are infrastructure/pre-existing issues, not release mode bugs.

*Completed by work action (Route B)*

## Testing

**Tests run:** `npm run test:all -- --release` (full release-qualifying run)
**Result:** All 4 verification checks pass. Release mode behaves correctly.

**Negative case verified:**
- `GCP_PROJECT_ID= GCS_PUBLIC_BUCKET= npx tsx scripts/test-all.ts --release --no-archive` → exit code 1 with clear error

*Verified by work action*
