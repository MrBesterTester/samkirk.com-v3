---
id: REQ-050
title: "Add --run timestamp flag"
status: completed
created_at: 2026-02-13T18:00:00Z
user_request: UR-007
claimed_at: 2026-02-13T19:10:00Z
route: B
completed_at: 2026-02-13T19:25:00Z
related: [REQ-043]
batch: "test-results-phase-3"
source_step: "3.3"
source_doc: "docs/test-results-TODO.md"
blueprint_ref: "docs/test-results-BLUEPRINT.md"
model_hint: "Sonnet 4"
---

# Add --run timestamp flag (Step 3.3)

## What
Add `--run <timestamp>` flag that selects a specific archived test run by partial timestamp match instead of defaulting to the latest.

## Checklist
- [x] Partial match on archive directory name (e.g. `2026-02-09` matches first dir starting with that prefix)
- [x] Error if no match or ambiguous match
- [x] TEST: `npm run test:results -- --run 2026-02-09`

## Blueprint Guidance

| Flag | Behavior |
|------|----------|
| `--run <timestamp>` | Show a specific run instead of latest |

## Context
- **Document set**: test-results
- **Phase**: 3 — Remaining Viewer Flags
- **Blueprint**: See docs/test-results-BLUEPRINT.md for full design
- **Model recommendation**: Sonnet 4 (advisory — use if your tool supports model selection)

## Dependencies
Depends on REQ-043 (core viewer with findLatestArchive). Phase 1 must be complete.

---
*Source: docs/test-results-TODO.md, Step 3.3*

---

## Triage

**Route: B** - Medium

**Reasoning:** Clear feature (select archive by timestamp) but need to find existing archive selection logic and CLI arg parsing patterns.

**Planning:** Not required

## Plan

**Planning not required** - Route B: Exploration-guided implementation

Rationale: Clear flag addition. Need to discover how archives are currently selected (findLatestArchive) and how CLI args are parsed.

*Skipped by work action*

## Exploration

- `findLatestArchive()` at line 158 sorts dirs lexicographically, returns last
- `args.run` already parsed by `getFlagValue("--run")` in `parseArgs()`
- Line 580: `args.run ?? findLatestArchive()` — uses raw value directly (no partial match)
- Archive dirs named `YYYY-MM-DD_HH-MM-SS` — partial prefix matching is natural
- Need new `findArchiveByPrefix()` function + update default view and other flag handlers

*Generated by Explore agent*

## Implementation Summary

- Added `findArchiveByPrefix(prefix)` function in `web/scripts/test-results.ts`
- Filters archive dirs by `startsWith(prefix)`, errors on 0 or >1 matches
- Updated default view (line 580) to use `findArchiveByPrefix` when `--run` provided
- Updated `--log` handler to also respect `--run` partial matching
- Error messages show list of ambiguous matches when multiple dirs match

*Completed by work action (Route B)*

## Testing

**Tests run:** `npx tsx scripts/test-results.ts --run 2026-02-09`
**Result:** ✓ Correctly reports ambiguous prefix with 6 matching archives

**Additional verification:**
- `--run 2026-02-09_17` → unique match, shows that run's summary
- `--run 9999` → "No archive matches prefix" error
- `--run 2026-02-09_17-03-27` → exact match works

*Verified by work action*
